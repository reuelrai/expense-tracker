<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dashboard - Expense Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="wrap">
        <h1>Expense Tracker Dashboard</h1>
        <a href="api/logout.php">Logout</a>

        <form id="expense-form">
            <input type="text" id="title" name="title" required>
            <input type="number" id="amount" name="amount" step="0.01" required>
            <select id="category" name="category">

                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Shopping">Shopping</option>
                <option value="Bills">Bills</option>
                <option value="Other">Other</option>
            </select>
            <button type="submit">Add</button>
        </form>

        <div id="summary">
            <h3>Total: <span id="total">$0.00</span></h3>
        </div>

        <div id="list"></div>
        <div id="empty" style="display:none">No expenses yet</div>

        <script>
            let items = [];
            const form = document.querySelector('#expense-form');
            const titleEl = document.querySelector('#title');
            const amountEl = document.querySelector('#amount');
            const categoryEl = document.querySelector('#category');
            const listEl = document.querySelector('#list');
            const totalEl = document.querySelector('#total');
            const emptyEl = document.querySelector('#empty');

            async function fetchAndRenderExpenses() {
                const res = await fetch('api/getExpenses.php');
                items = await res.json();
                render();
            }

            function render() {
                listEl.innerHTML = '';
                if (items.length === 0) { emptyEl.style.display = 'block'; return; }
                else emptyEl.style.display = 'none';
                let total = 0;
                items.forEach(it => {
                    const row = document.createElement('div');
                    row.textContent = `${it.title} - $${it.amount} [${it.category}]`;
                    const del = document.createElement('button');
                    del.textContent = 'Delete';
                    del.onclick = async () => {
                        await fetch('api/deleteExpense.php?id=' + it.id, { method: 'POST' });
                        fetchAndRenderExpenses();
                    };
                    row.appendChild(del);
                    listEl.appendChild(row);
                    total += parseFloat(it.amount);
                });
                totalEl.textContent = '$' + total.toFixed(2);
            }

            form.addEventListener('submit', async e => {
                e.preventDefault();
                const data = new FormData();
                data.append('title', titleEl.value);
                data.append('amount', amountEl.value);
                data.append('category', categoryEl.value);
                const res = await fetch('api/addExpense.php', { method: 'POST', body: data });
                const json = await res.json();
                if (json.status === 'success') {
                    titleEl.value = ''; amountEl.value = ''; categoryEl.value = 'Food';
                    fetchAndRenderExpenses();
                } else alert('Error adding expense');
            });

            fetchAndRenderExpenses();
        </script>
    </div>
</body>

</html>